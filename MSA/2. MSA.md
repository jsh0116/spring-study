# MicroService Architecture

## Software Architecture
* 소프트웨어를 구성하는 요소와 그 구성요소 간의 관계를 정의한 것
* 시스템 구축을 위한 여러 가지 비기능 요건(성능, 가용성, 보안, 유지보수성, 확장성 등)을 만족하는 다양한 해결 방법을 찾는 과정

## MSA
* Cloud라는 가상화된 Infra를 활용해 구조화 해야하기 때문에 특징을 고려해서 설계해야 한다.
* Cloud Infra를 사용할 때 고려할 때, Reactive System 구성을 고려해야 한다.

## Reactive System
> 다양한 상황에 따라 빠르고 적절하게 반응하는 시스템
> 급변하는 상황에 적응할 수 있는 시스템을 요구하는 것

### 리액티브 시스템을 만들기 위한 4가지 구성 요소
* 응답성(Responsive)
  * 사용자에게 신뢰성 있는 응답을 빠르고 적절하게 제공해야 한다.
* 탄력성(Resilient)
  * 사용자에게 가장 빠르고 적절한 응답을 제공하기 위해 장애로부터 빠르게 회복해야 한다.
  * 장애 발생 & 부분적 고장 나더라도 시스템 전체가 고장 나지 않고 빠르게 복구하는 능력
* 유연성(Elastic)
  * 시스템은 사용량 트래픽에 반응해 시스템 자원 조절을 유연하게 수행해야 한다.
  * 시스템의 사용량에 변화가 있더라도 균일한 응답성을 제공해야 한다.
  * 시스템 사용량에 비례하여 자원을 늘리거나 줄이는 능력
* 메시지 기반(Message-Driven)
  * 비동기 메시지 전달을 통해 위치 투명성, Loosely Coupling, Non-Blocling 통신을 지향한다.
  * Message-Driven 통신을 통해 Loosely Coupling과 위치 투명성을 제공해야 한다.

> `Architecture 유연성` : Reactive System이 반드시 갖춰야 할 공통적인 특성

신뢰성이 있는 응답을 빠르게 제공하고, 부분적 장애를 빨리 복구하며, 수요 증가에 탄력적으로 대응하기 위해서는 시스템 자체가 변화와 확장에 언제든지 대응할 수 있는 아키텍처 유연성을 갖추는 것이 필수이다.

## MSA 구성요소 및 Pattern
> `Architecture Style & Architecture Pattern`
> 아키텍처가 문제 영역에 대한 솔루션을 제공하고 어떤 해법으로 문제를 해결하는 등 여러 사람들에 의해 검증되어 정리된 유용한 해법

### Infra 구성요소
* Public, Private Cloud 환경
* Infra: `Hardware, Software, Networking 구성요소, OS, Data storage` 등
  * MicroService를 지탱하는 하부구조 Infra를 구축하는 데 필요한 구성요소
  * AWS, 구글, 마이크로소프트, IBM등 자동화된 IaaS(Infrastructure as a Service), PaaS(Platform as a Service)
  * 시스템의 자원 구성, 할당, 관리, 모니터링 등이 Cloud Service로 구성되어 있어 설정 작업이 간편해질 수 있다.
  * MicroService는 어떠한 환경에서도 유연하도록 구성돼야 하기 때문에 특정 Infra를 고집하지 않는다.
* Virtual Machine과 Container
  * VM의 경우 운영체제 패치 설치나 관련 라이브러리 설치 같은 오버헤드가 지속적으로 발생
  * MicroService 같은 작은 서비스를 패키지하고 배포하기에는 Container 환경이 더 적합하다.
  * Docker
    * 이식성 - 어떤 호스트 커널이나 플랫폼 버전에 상관없이 도커만 실행할 수 있으면 사용 가능하며 동일하게 동작
    * 신속성 - 크기가 작고 가볍기 때문에 빠른 배포 및 문제 발생 시 수정 없이 새로 기동하면 된다.
    * 재사용성 - 동일한 환경을 재사용해서 쉽게 설정이 가능해 개발, 테스트, 스테이징, 프로덕트 환경을 동일한 환경으로 구축하기 쉽다.
  * Container Orchestration
    * 컨테이너가 많아지면 자동 배치 및 복제, 장애 복구, 확장 및 축소, 컨테이너 간 통신, 로드 밸런싱 등의 컨테이너 관리 기능이 필요하다.
    * 도커 스웜(Docker Swarm), 아파치 메소스(Apache Mesos), 쿠버네티스(Kubernetes) 등이 있다.
    * 쿠버네티스
      * 자동화된 자원 배정 : 각 컨테이너가 필요로 하는 CPU와 메모리를 쿠버네티스에 요청하면 컨테이너를 노드에 맞춰 자동으로 배치한다.
      * 셀프 치유 : 컨테이너의 이상 유무를 점검해서 실패한 경우 자동으로 교체하고 재스케쥴링한다.
      * 수평 확장 : 일정 CPU 및 메모리 사용량을 초과하면 자동으로 확장한다.

 #### 서비스 유형별 대표적인 클라우드
 * IaaS(Infrastructrue as a Service)
  * 가상 머신, 스토리지, 네트워크 같은 인프라를 필요한 만큼 적시에 제공하는 서비스로서 사용자는 이러한 인프라를 이용해 개발 환경을 구성한 후 애플리케이션을 배포한다.
  * e.g. AWS EC2(Elastic compute Cloud), GCP Compute Engine, Azure VM
 * CaaS(Container as a Service)
  * 컨테이너 기반 가상화를 사용해 컨테이너를 업로드, 구성, 실행, 확장, 중지할 수 있는 서비스다.
  * 애플리케이션을 바로 구동할 수 있는 환경을 제공한다는 점에서 PaaS와 유사하지만 다른 환경에도 이식 가능한 컨테이너 기반 가상화를 제공한다는 점이 다르다.
  * e.g. 마이크로소프트 Azure Kubernetes Service(AKS), 아마존의 Elastic Kubernetes Service(EKS), Google Kubernetes Engine(GKE), AWS ECS
 * PaaS(Platform as a Service)
  * 복잡함 없이 애플리케이션을 곧바로 개발, 실행 관리할 수 있는 플랫폼 환경을 서비스 형태로 제공한다.
  * IaaS 위에 실제로 애플리케이션이 실행될 수 있는 미들웨어나 런타임까지 탑재된 환경이라 생각하면 이해하기 쉽다.
  * e.g. Azure Web App, Google App Engine, Cloud Foundry, Heroku, AWS Elastic Beanstalk
